<%@ page contentType="text/html; charset=UTF-8" language="java"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html>
<head>
<title>新增入库信息</title>
<link rel="stylesheet" type="text/css" href="Module/css/reset.css"/>
<link href="Module/css/pagination.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="Module/css/commonCss.css"/>
<link rel="stylesheet" type="text/css" href="Module/css/iconfont.css"/>
<link rel="stylesheet" type="text/css" href="Module/inStore/css/inStoreCss.css"/>
<link rel="stylesheet" type="text/css" href="Module/commonJs/timeControl/css/ion.calendar.css"/>
<script src="Module/commonJs/jquery-1.7.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="Module/commonJs/comMethod.js" type="text/javascript" charset="utf-8"></script>
<script src="Module/inStore/js/inStoreJs.js" type="text/javascript" charset="utf-8"></script>
<script src="Module/commonJs/checkStr.js" type="text/javascript" charset="utf-8"></script>
<script src="Module/basicInfo/js/commonExec.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="Module/commonJs/jquery.pagination.js"></script>
<script type="text/javascript">
var creScroll = true;
var roleName = "${sessionScope.login_user_dep_name}";
var pageSize = 8;
var page_index = 0;
var bTypeId_a = 0;
var pyCode_a = "";
var page_index_p = 0;//选择产品
var pTypeId_a = 0;//产品类别编号
var pyCode_p_a = "";//产品拼音码
var page_index_wh = 0;//货架
var wTypeId_a = 0;//库房类别编号
var whName_a = "";//货架名称
var pageSize_wh = 24;//货架页面每页记录条数
var option_tr = "inStore";//区别供应商的doubleTrClick()

var sTime_a = "";
var eTime_a = "";
var inStatus_a = -1;
var proId_a = 0;
var whId_a = 0;
var inOrder_a = 0;
var option_a = 0;
$(function(){
	if(roleName == "库房" ){
		choiceOption("inStoreInp","active","label","insStatusIn","iconFont");
	}else{
		//$("#headFunArea").html('<a id="viewPurBtn" href="javascript:void(0)" onclick="selPurchaseTab(2)">浏览入库单</a>');
		//selPurchaseTab(2);
	}
	choiceOption("inStoreInp","active","label","insStatusIn","iconFont");
	judgeTime_1();
	$("#inUserId_add").val("${sessionScope.login_real_name}");
	$("#inDate_add").val("${requestScope.inDate}");
});
//新增入库单下选取供应商数据 、选取供应商下商品的数据层弹窗
function showCorrUnProInfDiv(options){
	if(options == 1){//选取供应商
		$(".purDataDiv").show();
		inpTipFocBlur("searInput","请输入往来单位拼音码","#999","#666");
		if($("#categDataDivPur li").length == 0){
			$("#categDataDivPur").html("<div class='noRecCon'><i class='iconfont icon-noListRec noListRec'></i><p>暂无单位类别，请添加</p></div>");
		}
		getCommonType("bType");
		createLeftScroll("corUnCategDataDiv","categDataDivPur","categDataUlPur",options);
	}else if(options == 2){//选取商品
		$(".proInfoDiv").show();
		getCommonType("pType");
		createLeftScroll("proCategDataDiv ","categDataDivPro","categDataUlPro",options);
		inpTipFocBlur("searInput_pro","请输入产品拼音码","#999","#666");
	}else if(options == 3){//入库货架  
		$(".instWhDataDiv").show();
		getCommonType("wType");
		createLeftScroll("whCategDataDiv  ","categDataDivWh","categDataUlWh",options);
		inpTipFocBlur("searInput_insWh","请输入货架编号","#999","#666");
	}
	$(".layer").show();
	
}
function closeAlertWin(obj,module){
	page_index = 0;
	bTypeId_a = 0;
	pyCode_a = "";
	page_index_p = 0;//选择产品
	pTypeId_a = 0;//产品类别编号
	pyCode_p_a = "";//产品拼音码
	page_index_wh = 0;//货架
	wTypeId_a = 0;//库房类别编号
	whName_a = "";//货架名称
	if(module == "bc"){//供应商
		$("#searInput").val("请输入往来单位拼音码");
		$("#Pagination").hide();
		$("#dataListTab_un").html("");
		
	}else if(module == "pro"){//产品
		$("#searInput_pro").val("请输入产品拼音码");
		$("#Pagination_pro").hide();
		$("#dataListTab_pro").html("");
	}else if(module == "wh"){//货架
		$("#searInput_insWh").val("请输入货架编号");
		$("#whListUl").html("");
		$("#Pagination_wh").hide();
		//清空数据
		$("#selWhId").val("0").attr("alt","");
	}
	if($(".parScroll").length > 0){
		$(".parScroll").remove();
		$(".categDataUl").css({"top":0});
	}
	$(obj).hide();
	$(".layer").hide();
}
//浏览入库购单下头部的查询
function changeSearch(options){
	$(".selCondP label").removeClass("active");
	if(options == 1){//根据新增入库单时间查询
		$("#addInsTimSearLab").addClass("active");
		$(".searLayer").animate({"left":599});
		clearOption2();
	}else if(options == 2){//根据入库单号查询
		$("#insNumSearLab").addClass("active");
		$(".searLayer").animate({"left":0});
		inpTipFocBlur("queryInsNum","请输入入库单号","#999","#666");
		clearOption1();
	}
}
//添加单位类别、单位基本信息、产品类别、产品基本信息窗口
function showComAddWin(options){
	$(".closeIcon").hide();
	$(".addNewDataDiv").show().animate({"top":50},function(){
		if(options == 1){//添加仓库类别
			$(".addWhCategDiv").show();
		}else if(options == 2){//添加仓库货架信息
			$(".addWhInfoDiv").show();
		}
	});
}
function selCategBankWin(options){
	//1:查看仓库类别 
	if(options == 1){
		$(".selWhCategLay").show().animate({"opacity":1});
		var whId = $("#selCateg").attr("alt");
		loadWHTypeList(whId);
		if($(".selCategDiv_wh p").html() == ""){
			$("#nowCateg_wh").html("暂未选择仓库类别");
		}else{
			$("#nowCateg_wh").html($(".selCategDiv_wh p").html());
			matchingHtml($("#selCategWrap_wh li"),$("#nowCateg_wh"));
		}
		if($("#selCategWrap_wh li").length == 0){
			$("#selCategWrap_wh").html("<div class='noRecCon'><i class='iconfont icon-noListRec noListRec_1'></i><span>暂无产品类别，请添加</span></div>");
		}
		addLiActive($("#selCategWrap_wh li"),$("#nowCateg_wh"));
	}
}
function addLiActive(obj,objHtml){
	$(obj).each(function(){
		$(this).click(function(){
			$(obj).removeClass("active");
			$(this).addClass("active");
			$(objHtml).html($(this).html());
		});
	});
}
function matchingHtml(obj,objHtml){
	var htmlCon = objHtml.html();
	$(obj).each(function(i){
		if(htmlCon != "" && $(obj).eq(i).html() == htmlCon){
			$(obj).eq(i).addClass("active");
		}
	});
}

//分页获取货架列表
function showPageWSList(obj,wtId){
	if(wtId > 0){//按照仓库类别查询
		wTypeId_a = wtId;
		whName_a = "";
	}else{//指定货架查询
		var inputWhName = $("#searInput_insWh").val();
		if(inputWhName == "请输入货架编号"){
			inputWhName = "";
		}
		whName_a = inputWhName;
		wTypeId_a = 0;
	}
	var allCount = getWHCount(wTypeId_a,whName_a);//全部
	$("#categDataUlWh li").removeClass("active");
	$(obj).parent().addClass("active");
    $("#Pagination_wh").pagination(allCount, {
      callback: pageselectCallback_wh,  //PageCallback() 为翻页调用次函数。
      prev_text: "上一页",
      next_text: "下一页 ",
      items_per_page:pageSize_wh,
      current_page:page_index_wh,
      ellipse_text:"...",
      num_edge_entries: 2,       //两侧首尾分页条目数
      num_display_entries: 6	//连续分页主体部分分页条目数
    });
    $("#Pagination_wh").css({
 	 	"left":parseInt(($("#whTurnPage").width() - $("#Pagination_wh").width())/2),
 	 	"top":20
    });
}
//获取货架记录条数
function getWHCount(){
	var count = 0;
	$.ajax({
      type:"post",
      async:false,
      dataType:"json",
      url:"basic.do?action=getWHSCount",
      data:{whId:wTypeId_a,whsName:escape(whName_a)},
      success:function (json){
      	count = json["result"];
      }
  });
	return count;
}

//获取仓库货架列表
function loadWSList(pageNo,pageSize){
	$.ajax({
      type:"post",
      async:false,
      dataType:"json",
      url:"basic.do?action=getWHSList",
      data:{whId:wTypeId_a,whsName:escape(whName_a),pageNo:pageNo,pageSize:pageSize},
      success:function (json){
      	showWSList(json["wsList"]);
      }
  });
}
//显示仓库货架列表
function showWSList(list){
	var content = "";
	if(list.length > 0){
		$("#Pagination_wh").show();
		for(var i = 0 ; i < list.length ; i++){
			content += "<li id='li_wh_"+list[i].id+"' alt='"+list[i].id+"' class='ellip' title='"+ list[i].whsName +"' altTxt='"+list[i].whTypeInfo.whName+"'>"+list[i].whsName+"</li>";
		}
		$("#whListUl").html(content);
		singleLiClick();//货架单击事件
	}else{
		$("#Pagination_wh").hide();
		$("#whListUl").html("<div class='noRecCon1'><i class='iconfont icon-noListRec noListRec_1'></i><span>暂无仓库货架记录</span></div>");
	}
}
//显示出列表数据
function pageselectCallback_wh(page_index_wh,jq){
	loadWSList(page_index_wh+1,pageSize_wh);
}
//单击货架事件
function singleLiClick(){
	$("#whListUl li").each(function(){
		$(this).click(function(){
			$("#whListUl li").removeClass("active");
			$(this).addClass("active");
			$("#selWhId").val(($(this).attr("alt"))).attr("alt",$(this).html()+"  ("+$(this).attr("altTxt")+")");
		});
	});
}
//将刚选中的货架编号赋值且关闭窗口
function selWhInfo(){
	var whVar = "";
	if(option_tr == "listInStore"){
		whVar = "whNumInp";
		$("#"+whVar).attr("alt",$("#selWhId").val()).val($("#selWhId").attr("alt"));
		if($("#"+whVar).val() != ""){
			$("#delOptWh").show();
		}
	}else{
		whVar = "wtId_add";
		$("#"+whVar).attr("alt",$("#selWhId").val()).val($("#selWhId").attr("alt"));
	}
	closeSelWHWindow("searInput_insWh","selWhId","instWhDataDiv");
}

//清空新增入库单所有信息
function clearAllInOrderInfo(){
	$("#purVal").attr("alt","0").val("");
	$("#insOrder_add").val("");
	$("#proId_add").attr("alt","0").val("");
	$("#proNo_add").val("");
	$("#proUnit_add").val("");
	$("#proSpec_add").val("");
	$("#inNumber_add").val("");
	$("#wtId_add").attr("alt","0").val("");
	$(".inStoreInp").each(function(i){
		if($(".inStoreInp").eq(i).is(":checked")){
			$(".inStoreInp").eq(i).attr("checked",false);
			$(".inStoreInp").eq(i).parent().removeClass("active");
			$(".inStoreInp").eq(i).parent().find("i").remove();
		}
	});
	$("#insStatusIn").val("-1");
	$("#inRemark_add").val("");
}
//获取需要实际的入库数量（入库数量必须小于、等于数据库中需要入库的数量）
function getInStoreNum(bcId,proId){
	var activeInNum = 0;
	$.ajax({
        type:"post",
        async:false,
        dataType:"json",
        data:{bcId:bcId,proId:proId},
        url:"inStore.do?action=getRemainNum",
        success:function (json){
        	activeInNum = json["result"];
        }
    });
	return activeInNum;
}
//入库动作
function addInStore(){
	var bcId = $("#purVal").attr("alt").replace(/\s+/g, "");
	var inNo = $("#insOrder_add").val().replace(/\s+/g, "");
	var proId = $("#proId_add").attr("alt").replace(/\s+/g, "");
	var inNumber = $("#inNumber_add").val().replace(/\s+/g, "");
	var whId = $("#wtId_add").attr("alt").replace(/\s+/g, "");
	var inStatus = $("#insStatusIn").val().replace(/\s+/g, "");
	var remark = $("#inRemark_add").val().replace(/\s+/g, "");
	var bcFlag = false;
	var noFlag = false;
	var proFlag = false;
	var inFlag = false;
	var whFlag = false;
	var statusFlag = false;
	if(bcId == "0"){
		$("#corrUnTipDiv").find("p").html("请选择供应商");
		$("#corrUnTipDiv").show();
	}else{
		bcFlag = true;
		$("#corrUnTipDiv").hide();
	}
	if(inNo == ""){
		$("#insNumTipDiv").find("p").html("入库单号不能为空");
		$("#insNumTipDiv").show();
	}else if(checkIsNumeric(inNo)){
		$("#insNumTipDiv").find("p").html("入库单号只能是字母");
		$("#insNumTipDiv").show();
	}else{
		$("#insNumTipDiv").hide();
		noFlag = true;
	}
	if(proId == "0"){
		$("#proNamTipDiv").find("p").html("产品不不能为空");
		$("#proNamTipDiv").show();
	}else{
		$("#proNamTipDiv").hide();
		proFlag = true;
	}
	if(inNumber == ""){
		$("#inStNumDiv").find("p").html("入库数量不能为空");
		$("#inStNumDiv").show();
	}else if(!checkIsNumber(inNumber)){
		$("#inStNumDiv").find("p").html("入库数量格式错误");
		$("#inStNumDiv").show();
	}else{
		var activeInNum = getInStoreNum(bcId,proId);//数据库中实际需要入库的数量总和
		if(activeInNum == 0){
			$("#inStNumDiv").find("p").html("该产品可能未采购或已全部入库");
			$("#inStNumDiv").show();
		}else if(activeInNum < inNumber){
			$("#inStNumDiv").find("p").html("经查，等待入库总量是"+activeInNum+"。");
			$("#inStNumDiv").show();
		}else{
			$("#inStNumDiv").hide();
			inFlag = true;
		}
	}
	if(whId == "0"){
		$("#inStWhDiv").find("p").html("入库货架不能为空");
		$("#inStWhDiv").show();
	}else{
		$("#inStWhDiv").hide();
		whFlag = true;
	}
	if(inStatus == "-1"){
		$("#inStStaDiv").find("p").html("录入状态不能为空");
		$("#inStStaDiv").show();
	}else{
		$("#inStStaDiv").hide();
		statusFlag = true;
	}
	if(bcFlag && noFlag && proFlag && inFlag && whFlag && statusFlag){
		$.ajax({
	        type:"post",
	        async:false,
	        dataType:"json",
	        data:{bcId:bcId,inNo:$("#preSuffix").val()+"_"+inNo,proId:proId,inNumber:inNumber,whId:whId,inStatus:inStatus,remark:escape(remark)},
	        url:"inStore.do?action=addInStore",
	        success:function (json){
	        	if(json["result"]){
	        		alert("入库成功");
	        		clearAllInOrderInfo();
	        	}else{
	        		alert("入库失败");
	        	}
	        }
	    });
	}
	
}
//获取仓库类别列表
function loadWHTypeList(whId){
	$.ajax({
        type:"post",
        async:false,
        dataType:"json",
        url:"basic.do?action=getWHSTypeList",
        success:function (json){
        	showWHTypeList(json["wtList"],whId);
        }
    });
}
//显示仓库类别列表
function showWHTypeList(list,whId){
	var content = "";
	if(list != null){
		for(var i = 0 ; i < list.length ; i++){
			if(whId == list[i].id){
				content += "<li class='active'>";
			}else{
				content += "<li>";
			}
			content += "<span onclick=selctWHType('"+list[i].id+"','"+list[i].whName+"')>"+list[i].whName+"</span>";
			content += "</li>";
		}
	}else{
		content = "<div class='noAddCateg margL6'><img src='Module/basicInfo/images/noCategWhRec1.png' alt='暂未添加仓库类别'/></div>";
	}
	$("#selCategUl_wh").html(content);
}
//增加货架时选择仓库类别
function selctWHType(whId,whName){
	$("#nowCateg_wh").html(whName);
	$("#nowCateg_wh").attr("alt",whId);
}
//确定选择仓库类别动作
function selectCateg(){
	var whId = $("#nowCateg_wh").attr("alt");
	var whName = $("#nowCateg_wh").text();
	if(whId == 0){
		alert("请选择一个仓库类别");
	}else{
		$("#selCateg").text(whName);
		$("#selCateg").attr("alt",whId);
		comCanCategBankWin(1);
	}
}
//增加货架时关闭选择仓库类别用
function comCanCategBankWin(options){
	//1:关闭选择仓库类别
	if(options == 1){
		$(".selWhCategLay").animate({"opacity":0},function(){$(".selWhCategLay").hide();});
		$("#selCategWrap_wh li").removeClass("active");
	}
}
//入库时添加仓库类别、货架时关闭窗口用
function comCancelAdd(options){
	$(".addNewDataDiv").animate({"top":-400},function(){
		if(options == 5){//关闭添加货架
			$("#whsName_add").val("").attr("alt",0);
			$("#selCateg").text("").attr("alt","0");
			$("#whsRemark_add").val("");
			$("#whNameDiv").hide();
			$("#whCategDiv").hide();
		}else if(options == 6){//关闭添加仓库类别窗口
			$("#whTypeName_add").val("");
			$("#wtRemark_add").val("");
			$("#categWhNaDiv").hide();
		}
		$(".addWhInfoDiv").hide();
		$(".addWhCategDiv").hide();
		$(".addNewDataDiv").hide();
		$(".closeIcon").show();
	});
}
//清空查询条件1
function clearOption1(){
	$("#sTime").val("").attr("placeholder","请选择开始时间");
	$("#eTime").val("").attr("placeholder","请选择结束时间");
	$(".inStoreQue").each(function(i){
		if($(".inStoreQue").eq(i).is(":checked")){
			$(".inStoreQue").eq(i).attr("checked",false);
			$(".inStoreQue").eq(i).parent().removeClass("active");
			$(".inStoreQue").eq(i).parent().find("i").remove();
		}
	});
	$("#insStaInpVal").val("-1");
	$("#proNaInp").val("").attr("alt",0);
	$("#whNumInp").val("").attr("alt",0);
}
//清空查询条件2
function clearOption2(){
	$("#queryInsNum").val("请输入入库单号");
	$("#sTime").val("${requestScope.sTime}");
	$("#eTime").val("${requestScope.inDate}");
}
//初始入库单
function queryOrder(status){
	if(status == 0){//初始查询近三天的所有入库单
		clearOption1();
		clearOption2();	
	}
	sTime_a = $("#sTime").val().replace(/\s+/g, "");
	eTime_a = $("#eTime").val().replace(/\s+/g, "");
	if(sTime_a > eTime_a){
		alert("入库时间选择错误");
	}else{
		inStatus_a = $("#insStaInpVal").val().replace(/\s+/g, "");
		proId_a = $("#proNaInp").attr("alt").replace(/\s+/g, "");
		whId_a = $("#whNumInp").attr("alt").replace(/\s+/g, "");
		inOrder_a = $("#queryInsNum").val().replace(/\s+/g, "");
		option_a = status;
		if(inOrder_a == "请输入入库单号"){
			inOrder_a = 0;
		}
		var allCount = getInOrderCount();//全部
	    $("#Pagination_in").pagination(allCount, {
	        callback: pageselectCallback_in,  //PageCallback() 为翻页调用次函数。
	        prev_text: "上一页",
	        next_text: "下一页 ",
	        items_per_page:pageSize,
	        current_page:page_index,
	        ellipse_text:"...",
	        num_edge_entries: 2,       //两侧首尾分页条目数
	        num_display_entries: 6	//连续分页主体部分分页条目数
	    });
	    $("#Pagination_in").css({
	 	 	"left":parseInt(($("#viewTurnPage").width() - $("#Pagination_in").width())/2),
	 	 	"top":-10
	    });
		
	}
}
//根据条件获取记录数
function getInOrderCount(){
	var count = 0;
	$.ajax({
		type:"post",
	    async:false,
	    dataType:"json",
	    data:{sTime:sTime_a,eTime:eTime_a,inStatus:inStatus_a,proId:proId_a,whId:whId_a,inOrder:inOrder_a,option:option_a},
	    url:"inStore.do?action=getInOrderCount",
	    success:function (json){
	    	count = json["result"];
	    }
	});
	return count;
}
//分页获取入库记录
function getInStorePageInfo(pageNo,pageSize){
	var content = "";
	$.ajax({
		type:"post",
	    async:false,
	    dataType:"json",
	    data:{sTime:sTime_a,eTime:eTime_a,inStatus:inStatus_a,proId:proId_a,whId:whId_a,
	    	inOrder:inOrder_a,option:option_a,pageNo:pageNo,pageSize:pageSize},
	    url:"inStore.do?action=getInOrderPageInfo",
	    success:function (json){
	    	if(json["result"].length > 0){
	    		$("#Pagination_in").show();
				content = "<ul class='cardUl clearfix'>";
				var isObj = json["result"];
				for(var i = 0 ; i < isObj.length ; i++){
					content += "<li class=cardLi>";
					content += "<div class=cardDiv>";
					content += "<div class=front>";
					content += "<div class=comInnerInfo>";
					content += "<h4>"+isObj[i].inONo+"</h4>";
					var inStatus = isObj[i].inStatus;
					var inStatusTxt = "";
					if(inStatus == 0){
						inStatusTxt = "期初库存";
					}else if(inStatus == 1){
						inStatusTxt = "采购入库";
					}else if(inStatus == 2){
						inStatusTxt = "加工半成品入库  ";
					}else if(inStatus == 3){
						inStatusTxt = "加工成品入库";
					}
					content += "<p class=inStaP>录入状态："+inStatusTxt+"</p>";
					content += "<span class=lineSpan></span>";
					content += "<strong>"+isObj[i].productInfo.proName+"</strong>";
					content += "<p class=proNumP>产品编码："+isObj[i].productInfo.proNo+"</p>";
					content += "<p class=whNumP>";
					content += "<span class=lDecSpan></span>";
					content += "<span class=rDecSpan></span>";
					content += "<span class=whNumCon>"+isObj[i].whStorageInfo.whTypeInfo.whName + " " + isObj[i].whStorageInfo.whsName +"</span>";
					content += "</p>";
					content += "</div>";
					content += "<span class=shadowSpan></span>";
					content += "</div>";
					
					content += "<div class=back>";
					content += "<div class=comInnerInfo>";
					content += "<ul><li class=clearfix>";
					content += "<p class='flP txtInd'>库存量："+isObj[i].productInfo.proNumber+"</p>";
					content += "<p class=flP>入库数量："+isObj[i].inNumber+"</p>";
					content += "<p class='flP txtInd'>入库人员："+isObj[i].userInfo.userName+"</p>";
					content += "<p class='flP'>入库时间："+getLocalDate(isObj[i].inDate)+"</p>";
					content += "</li></ul>";
					content += "<p class='noFlP'>产品规格："+isObj[i].productInfo.proSpec+"</p>";
					content += "<p class='noFlP'>材质要求："+isObj[i].productInfo.proCz+"</p>";
					content += "<p class='noFlP'>发&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;货："+isObj[i].businessContactInfo.bcName+"</p>";
					content += "</div>";
					content += "<span class='shadowSpan'></span>";
					//content += "<a href='javascript:void(0)'></a>";
					content += "</div>";
					content += "</div>";
					content += "</li>";
				}
				content += "</ul>";
	    	}else{
	    		$("#Pagination_in").hide();
	    		content = "<div class='noRecCon'><i class='iconfont icon-noListRec noListRec_1'></i><span>暂无入库单记录</span></div>";
	    	}
	    	$("#inOrderListDiv").html(content);
	    }
	});
}
//显示出列表数据
function pageselectCallback_in(page_index,jq){
	getInStorePageInfo(page_index+1,pageSize);
}
//清除条件
function delOption(option){
	if(option == "pro"){
		$("#proNaInp").val("").attr("alt","0");
		$("#delOptPro").hide();
	}else if(option == "wh"){
		$("#whNumInp").val("").attr("alt","0");
		$("#delOptWh").hide();
	}
}
</script>
</head>
<body>
	<!-- 头部  -->
	<div class="headWrap">
		<img class="logo fl" src="Module/basicInfo/images/logo.png" alt="镜片车间ERP管理系统"/>
		<div class="perInfoBox fr">
			<div class="perInfo clearfix fl">
				<img class="fl" src="Module/basicInfo/images/user.png"/>
				<p class="timeHello fl"></p>
				<p class="fl">${sessionScope.login_real_name}</p>
			</div>
			<a class="exit fr" href="javascript:void(0)" title="退出系统" onclick="loginOut();">
				<i class="iconfont icon-tuichu exitIcon"></i>
			</a>
		</div>
	</div>
	<!-- 主体  -->
	<div class="mainWrap clearfix">
		<!-- 左侧导航  -->
		<div class="leftPart"></div>
		<div class="leftSmallNav lfSmNavWid">
			<ul>
				<li onclick="goBasicPage('goProCategoryPage',this)"><span></span>添加产品类别</li>
				<li onclick="goBasicPage('goProPage',this)"><span></span>添加产品信息</li>
				<li onclick="goBasicPage('goBusinessPage',this)"><span></span>添加往来单位信息</li>
				<li onclick="goBasicPage('goWHStoragePage',this)"><span></span>添加仓库货架信息</li>
				<li onclick="goBasicPage('goPurchasePage',this)"><span></span>采购信息</li>
				<li class="active" onclick="goBasicPage('goInstorePage',this)"><span></span>入库</li>
			</ul>
		</div>
		<!-- 右侧对应内容  -->
		<div class="rightPart noSmaNav">
			<!-- 头部搜索框 -->
			<div class="searWrap">
				<div class="searBox comMainWid">
					<p id="headFunArea">
						<a id="addNewPurBtn" class="active" href="javascript:void(0)" onclick="selPurchaseTab(1)">新增入库单</a>
						<span>|</span>
						<a id="viewPurBtn" href="javascript:void(0)" onclick="selPurchaseTab(2)">浏览入库单</a>
					</p>
				</div>
			</div>
			<!-- 新增采购单  -->
			<div class="mainCon comMainWid newAddPurDiv clearfix">
				<!-- 供应商选择、采购编号填写层  -->
				<div class="selBusDiv clearfix">
					<div class="comSelDiv fl">
						<span>供应商：</span>
						<input id="purVal" type="text" disabled="disabled" alt="0"/>
						<i class="iconfont icon-corrUnit comInsIcon pos1" onclick="showCorrUnProInfDiv(1)" title="选择供应商"></i>
						<!-- input提示信息 -->
						<div id="corrUnTipDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucCorUnit" class="iconfont icon-duihao sucInfoIcon2"></i>
					</div>
					<div class="comSelDiv margSelL fl">
						<span>入库单编号：</span>
						<span id="insOrderInfo">
							<select id="preSuffix">
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C">C</option>
								<option value="D">D</option>
								<option value="E">E</option>
								<option value="F">F</option>
								<option value="G">G</option>
								<option value="H">H</option>
								<option value="I">I</option>
								<option value="J">J</option>
								<option value="K">K</option>
								<option value="L">L</option>
							</select>
							<input type="text" id="insOrder_add" class="insInp" maxlength="6"/>
						</span>
						<!-- input提示信息 -->
						<div id="insNumTipDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucInsNum" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv margSelL fl">
						<span>产品名称：</span>
						<input id="proId_add" type="text" disabled="disabled" alt="0"/>
						<i class="iconfont icon-product comInsIcon pos2" onclick="showCorrUnProInfDiv(2)" title="选择产品"></i>
						<!-- input提示信息 -->
						<div id="proNamTipDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucProNam" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv fl">
						<span>产品编号：</span>
						<input id="proNo_add"  type="text" disabled="disabled"/>
						<i id="sucProNum" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv margSelL fl">
						<span>基本单位：</span>
						<input id="proUnit_add" type="text" disabled="disabled"/>
						<i id="sucBasUnit" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv margSelL fl">
						<span>产品规格：</span>
						<input id="proSpec_add" type="text" disabled="disabled"/>
						<i id="sucProFormat" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv fl">
						<span>入库数量：</span>
						<input type="text" id="inNumber_add"/>
						<!-- input提示信息 -->
						<div id="inStNumDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucInStNum" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv margSelL fl">
						<span>入库货架：</span>
						<input id="wtId_add" type="text" alt="0" disabled="disabled"/>
						<i class="iconfont icon-whose comInsIcon pos3" onclick="showCorrUnProInfDiv(3)" title="选择货架"></i>
						<!-- input提示信息 -->
						<div id="inStWhDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucInStWh" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv margSelL fl">
						<span>入库人员：</span>
						<input type="text" id="inUserId_add" disabled="disabled"/>
						<i id="sucInStPeo" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv fl">
						<span>入库日期：</span>
						<input type="text" id="inDate_add" disabled="disabled"/>
						<i id="sucInStTim" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					
					<div class="comSelDiv margSelL fl">
						<span>入库备注：</span>
						<input id="inRemark_add" type="text" maxlength="20" placeholder="备注不能超过20个字"/>
						<!-- input提示信息 -->
						<div id="inStRemDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucInStRem" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
					<div class="comSelDiv1 fl">
						<input id="insStatusIn" type="hidden" value="-1"/>
						<span class="fl">录入状态：</span>
						<label for="beginWhInp">
							<input type="radio" id="beginWhInp" class="inStoreInp" name="insStatus" value="0"/>
							<em>期初库存</em>
							<span class="cirSpan"></span>
						</label>
						<label for="purInsInp">
							<input type="radio" id="purInsInp" class="inStoreInp" name="insStatus" value="1"/>
							<em>采购入库</em>
							<span class="cirSpan"></span>
						</label>
						<label for="madInsInp">
							<input type="radio" id="madInsInp" class="inStoreInp" name="insStatus" value="2"/>
							<em>加工半成品入库</em>
							<span class="cirSpan"></span>
						</label>
						<label for="madFullInsInp">
							<input type="radio" id="madFullInsInp" class="inStoreInp" name="insStatus" value="3"/>
							<em>加工成品入库</em>
							<span class="cirSpan"></span>
						</label>
						<!-- input提示信息 -->
						<div id="inStStaDiv" class="tipDiv" >
							<span class="tipTriSpan"></span>
							<p></p>
						</div>
						<i id="sucInStSta" class="iconfont icon-duihao sucInfoIcon"></i>
					</div>
				</div>
				<div class="saveDiv">
					<a href="javascript:void(0)" onclick="addInStore();">保存入库信息</a>
				</div>
			</div>
			<!-- 浏览采购单  -->
			<div class="mainCon comMainWid viewPurDiv clearfix">
				<!-- 根据采购订单单号查询、根据新增采购单时间查询  -->
				<div class="queryDiv clearfix">
					<p class="selCondP">
						<label id="addInsTimSearLab" class="active" onclick="changeSearch(1)">
							<span class="cirSpan"></span>
							<span>根据新增入库单时间查询</span>
							<i class="iconfont icon-duihao selSearIcon"></i>
						</label>
						<label id="insNumSearLab" class="marglLab" onclick="changeSearch(2)">
							<span class="cirSpan"></span>
							<i class="iconfont icon-duihao selSearIcon"></i>
							<span>根据入库单号查询</span>
						</label>
					</p>
					<div class="queryBox fl">
						<div class="comQueryDiv">
							<span>新增入库单时间：</span>
							<input type="text" id="sTime" class="date" placeholder="请选择开始日期"/>&nbsp;&nbsp;
							<input type="text" id="eTime" class="date" placeholder="请选择结束日期"/>
						</div>
						<script src="Module/commonJs/timeControl/js/moment.min.js"></script>
						<script src="Module/commonJs/timeControl/js/moment.zh-cn.js"></script>
						<script src="Module/commonJs/timeControl/js/ion.calendar.min.js"></script>
						<script>
							$('.date').each(function(){
								$(this).ionDatePicker({
									lang: 'zh-cn',
									format: 'YYYY-MM-DD'
								});
							});
						</script>
						<div class="comQueryDiv">
							<input id="insStaInpVal" type="hidden" value="-1"/>
							<span>录入状态：</span>
							<label for="fullInsInp">
								<span class="cirSpan"></span>
								<input type="radio" id="madeFuInsInp" class="inStoreQue" name="insStaInp" value="-1"/>
								<span>全部</span>
							</label>
							<label for="begInsWhInp">
								<span class="cirSpan"></span>
								<input type="radio" id="begInsWhInp" class="inStoreQue" name="insStaInp" value="0"/>
								<span>期初库存</span>
							</label>
							<label for="purInstInp">
								<span class="cirSpan"></span>
								<input type="radio" id="purInstInp" class="inStoreQue" name="insStaInp" value="1"/>
								<span>采购入库</span>
							</label>
							<label for="madeInsInp">
								<span class="cirSpan"></span>
								<input type="radio" id="madeInsInp" class="inStoreQue" name="insStaInp" value="2"/>
								<span>加工半成品入库</span>
							</label>
							<label for="madeInsInp">
								<span class="cirSpan"></span>
								<input type="radio" id="madeFuInsInp" class="inStoreQue" name="insStaInp" value="3"/>
								<span>加工成品入库</span>
							</label>
						</div>
						<div class="comQueryDiv">
							<!-- 选择产品名称  -->
							<div class="selQueryDiv">
								<span>产品名称：</span>
								<input id="proNaInp" type="text" disabled="disabled" alt="0"/>
								<i id="delOptPro" class="iconfont icon-close clearIcon1" onclick="delOption('pro')" title="清除"></i>
								<i class='iconfont icon-more moreIcon posMore1' title='选择产品' onclick="showCorrUnProInfDiv(2)"></i>
							</div>
							<!-- 选择货架编号  -->
							<div class="selQueryDiv margLQu">
								<span>货架编号：</span>
								<input id="whNumInp" class="ellip" type="text" disabled="disabled" alt="0"/>
								<i id="delOptWh" class="iconfont icon-close clearIcon2" onclick="delOption('wh')" title="清除"></i>
								<i class='iconfont icon-more moreIcon posMore2' title='选择货架' onclick="showCorrUnProInfDiv(3)"></i>
							</div>
						</div>
						<a class="queryStaBtn" href="javascript:void(0)" onclick="queryOrder(1);">查询</a>
					</div>
					<div class="queryBox fl">
						<p class="searchPurNum fl">
							<input type="text" id="queryInsNum" value="请输入入库单号" class="searInp_purNum fl"/>
							<a href="javascript:void(0)" class="searA fl" title="查询" onclick="queryOrder(2);">
								<i class="iconfont icon-search searIcon"></i>
							</a>
						</p>
					</div>
					<span class="borSpan"></span>
					<!-- 二选一查询条件遮罩层  -->
					<span class="searLayer"></span>
				</div>
				<!-- 浏览入库单  -->
				<div class="viewInsInfoDiv" id="inOrderListDiv"></div>
				<div id="viewTurnPage" class="comTurnPagDiv">
					<div id="Pagination_in" class="pagination clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="layer"></div>
	<!-- 供应商数据层弹窗  -->
	<div class="comAlertDiv purDataDiv">
		<div class="comDataTop">
			<p>选择供应商</p>
			<i class="iconfont icon-close closeIcon comTransition" onclick="closeAlertWin($('.purDataDiv'),'bc')"></i>
		</div>
		<div class="searLay">
			<!-- 根据拼音码搜索层  -->
			<div class="searchDiv">
				<input type="text" id="searInput" value="请输入往来单位拼音码" class="searInp fl"/>
				<a href="javascript:void(0)" class="searA fl" title="查询" onclick="queryBusinessList(0);">
					<i class="iconfont icon-search searIcon"></i>
				</a>
			</div>
		</div>
		<!-- 往来单位类别 单位具体信息数据层  -->
		<div class="comDataDiv clearfix">
			<!-- left 类别数据  -->
			<div class="comLeftData corUnCategDataDiv fl">
				<p class="categTit"><i class="iconfont icon-categ categIcon"></i><span>往来单位类别</span></p>
				<div id="categDataDivPur" class="categDataDiv">
					<ul id="categDataUlPur" class="categDataUl">
						<!-- li下增加active状态为当前选中  -->
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p class="ellip">供应商</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p>供应商1</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p>供应商2</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p>客户</p></li>
					</ul>
				</div>
			</div>
			<!-- right 详细信息数据  -->
			<div class="comRightData fl">
				<!-- 数据层  -->
				<div class="tabData">
					<table class="dataTitTab" cellpadding="0" cellspacing="0">
						<tr>
							<td class="listDataWid1" align="center">序号</td>
							<td class="listDataWid2" align="center">单位名称</td>
							<td class="listDataWid3" align="center">拼音码</td>
							<td class="listDataWid3" align="center">联系人</td>
							<td class="listDataWid4" align="center">联系电话</td>
							<td class="listDataWid4" align="center">联系手机</td>
							<td class="listDataWid2" align="center">电子邮箱</td>
							<td class="listDataWid5 noBorR" align="center">单位地址</td>
						</tr>
					</table>
					<table id="dataListTab_un" class="dataListTab" cellpadding="0" cellspacing="0">
						<!-- 分页的话一页8条数据  -->

					</table>
				</div>
				<!-- 翻页  -->
				<div id="bsTurnPage" class="comTurnPagDiv">
					<div id="Pagination" class="pagination clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- 选择产品数据弹窗  -->
	<div class="comAlertDiv proInfoDiv">
		<div class="comDataTop">
			<p>选择产品</p>
			<i class="iconfont icon-close closeIcon comTransition" onclick="closeAlertWin($('.proInfoDiv'),'pro')"></i>
		</div>
		<div class="searLay">
			<!-- 根据拼音码搜索层  -->
			<div class="searchDiv">
				<input type="text" id="searInput_pro" value="请输入产品拼音码" class="searInp fl"/>
				<a href="javascript:void(0)" class="searA fl" title="查询" onclick="showProductList(0)">
					<i class="iconfont icon-search searIcon"></i>
				</a>
			</div>
		</div>
		<!-- 产品类别产品具体信息数据层  -->
		<div class="comDataDiv clearfix">
			<!-- left 类别数据  -->
			<div class="comLeftData proCategDataDiv fl">
				<p class="categTit"><i class="iconfont icon-categ categIcon"></i><span>产品类别</span></p>
				<div id="categDataDivPro" class="categDataDiv">
					<ul id="categDataUlPro" class="categDataUl">
						<!-- li下增加active状态为当前选中  -->
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p class="ellip">百货</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p>文具</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p>沙硅</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p>学习用具</p></li>
						<li><span></span><i class="iconfont icon-mingpian cardIcon"></i><p class="ellip">百货</p></li>
					</ul>
				</div>
			</div>
			<!-- right 详细信息数据  -->
			<div class="comRightData fl">
				<!-- 数据层  -->
				<div class="tabData">
					<table class="dataTitTab" cellpadding="0" cellspacing="0">
						<tr>
							<td class="lisDaWid1" align="center">序号</td>
							<td class="lisDaWid2" align="center">产品名称</td>
							<td class="lisDaWid2" align="center">产品编码</td>
							<td class="lisDaWid4" align="center">产品库存</td>
							<td class="lisDaWid2" align="center">产品规格</td>
							<td class="lisDaWid4" align="center">最高价格</td>
							<td class="lisDaWid4 noBorR" align="center">最低价格</td>
						</tr>
					</table>
					<table id="dataListTab_pro" class="dataListTab" cellpadding="0" cellspacing="0">
						<!-- 分页的话一页8条数据  -->
					</table>
				</div>
				
				<div id="proTurnPage" class="comTurnPagDiv">
					<div id="Pagination_pro" class="pagination clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- 选择仓库数据弹窗  -->
	<div class="comAlertDiv instWhDataDiv">
		<div class="comDataTop">
			<p>选择货架编号</p>
			<i class="iconfont icon-close closeIcon comTransition" onclick="closeAlertWin($('.instWhDataDiv'),'wh')"></i>
		</div>
		<div class="searLay">
			<!-- 根据货架编号搜索层  -->
			<div class="searchDiv">
				<input type="text" id="searInput_insWh" value="请输入货架编号" class="searInp fl"/>
				<a href="javascript:void(0)" class="searA fl" title="查询" onclick="showPageWSList(null,0)">
					<i class="iconfont icon-search searIcon"></i>
				</a>
			</div>
			<!-- 增加仓库类别层  -->
			<a class="addCategUnitBtn" href="javascript:void(0)" onclick="showComAddWin(1)">
				<i class="iconfont icon-tianjia addCaIcon fl"></i>
				<span class="fl">添加仓库类别</span>
			</a>
			<!-- 增加仓库货架基本信息层  -->
			<a class="addCategBtn" href="javascript:void(0)" onclick="showComAddWin(2)">
				<i class="iconfont icon-tianjia addCaIcon fl"></i>
				<span class="fl">添加货架</span>
			</a>
		</div>
		<!-- 选择货架类别货架编号具体信息数据层  -->
		<div class="comDataDiv clearfix">
			<!-- left 类别数据  -->
			<div class="comLeftData whCategDataDiv fl">
				<p class="categTit"><i class="iconfont icon-categ categIcon"></i><span>仓库类别</span></p>
				<div id="categDataDivWh" class="categDataDiv">
					<ul id="categDataUlWh" class="categDataUl">
						<!-- li下增加active状态为当前选中  -->
					</ul>
				</div>
			</div>
			<!-- right 详细信息数据  -->
			<div class="comRightData fl">
				<!-- 数据层  -->
				<div id="whListDiv" class="tabData">
					<ul id="whListUl" class="selWhDataUl clearfix">
					</ul>
				</div>
				<input type="hidden" id="selWhId" value="0" alt=""/>
				<div id="whTurnPage" class="comTurnPagDiv">
					<div id="Pagination_wh" class="pagination clearfix"></div>
				</div>
				<div class="botDiv">
					<!-- 选中保存按钮  -->
					<a class="saveDataBtn fr" href="javascript:void(0)" onclick="selWhInfo();">确定</a>
				</div>
			</div>
		</div>
		<!-- 添加仓库类别和仓库货架编号遮罩层  -->
		<div class="addNewDataDiv addWhCateg">
			<!-- 添加仓库类别  -->
			<div class="addWhCategDiv">
				<div class="comCategDiv margT_cate">
					<span>类别名称：</span>
					<input type="text" class="comInp_add" id="whTypeName_add"/>
					<!-- input提示信息  -->
					<div id="categWhNaDiv" class="tipDiv">
						<span class="tipTriSpan"></span>
						<p></p>
					</div>
					<i id="sucWhCategNam" class="iconfont icon-duihao sucInfoIcon"></i>
				</div>
				<div class="comCategDiv">
					<span>类别备注：</span>
					<input type="text" class="comInp_add" id="wtRemark_add" maxlength="20" placeholder="最多不超过20个字"/>
				</div>
				<a class="saveCategBtn" href="javascript:void(0)" onclick="addCommWType('addWhCategDiv','whTypeName_add','wtRemark_add','categWhNaDiv','inStore','wt')">添加保存</a>
				<a class="cancelBtn" href="javascript:void(0)" onclick="comCancelAdd(6)">取消</a>
			</div>
			<!-- 添加货架基本信息 -->
			<div class="addWhInfoDiv">
				<div class="comAddDiv1 margT1">
					<span>货架名称：</span>
					<input type="text" class="comInp_add" id="whsName_add" alt="0"/>
					<!-- input提示信息 -->
					<div id="whNameDiv" class="tipDiv">
						<span class="tipTriSpan"></span>
						<p>货架名称不能为空</p>
					</div>
					<i id="sucWhName" class="iconfont icon-duihao sucInfoIcon"></i>
				</div>
				<div class="comAddDiv1">
					<span class="fl">仓库类别：</span>
					<div class="selCategDiv_wh fl">
						<!-- 将确定的分类增加到p标签里面 -->
						<p id="selCateg" alt="0"></p>
						<a class="classifyA" href="javascript:void(0)" title="查看分类" onclick="selCategBankWin(1)">
							<i class="iconfont icon-fenlei2 classifyIcon"></i>
						</a>
					</div>
					<!-- input提示信息 -->
					<div id="whCategDiv" class="tipDiv">
						<span class="tipTriSpan"></span>
						<p>仓库类别不能为空</p>
					</div>
					<i id="sucWhCateg" class="iconfont icon-duihao sucInfoIcon1"></i>
				</div>
				<div class="comAddDiv1">
					<span>货架备注：</span>
					<input type="text" class="comInp_add" id="whsRemark_add" maxlength="20" placeholder="最多不超过20个字"/>
				</div>
				<a class="saveWhInfoBtn" href="javascript:void(0)" onclick="addOrEditCommWH('whsName_add','selCateg','whsRemark_add','whNameDiv','whCategDiv','inStore','addNewDataDiv');">添加保存</a>
				<a class="cancelBtn" href="javascript:void(0)" onclick="comCancelAdd('5')">取消</a>
				<!-- 选择产品类别层  -->
				<div class="selWhCategLay">
					<p class="nowCategP">当前类别&gt;&gt;<span id="nowCateg_wh" alt="0"></span></p>
					<div id="selCategWrap_wh">
						<ul id="selCategUl_wh" class="clearfix">
							<li>钢笔耗材类</li>
							<li>镜片耗材</li>
							<li>钢笔耗材类</li>
							<li>镜片耗材</li>
							<li>钢笔耗材类</li>
							<li>钢笔耗材类</li>
						</ul>
					</div>
					<a class="selCategBtn" href="javascript:void(0)" onclick="selectCateg()">确定</a>
					<a class="cancelBtn" href="javascript:void(0)" onclick="comCanCategBankWin(1)">取消</a>
				</div>
			</div>
		</div>
	</div>
</body>
</html>