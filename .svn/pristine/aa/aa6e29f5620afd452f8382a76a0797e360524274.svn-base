<%@ page contentType="text/html; charset=UTF-8" language="java"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html>
<head>
<title>产品损耗</title>
<link rel="stylesheet" type="text/css" href="Module/css/reset.css"/>
<link href="Module/css/pagination.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="Module/css/commonCss.css"/>
<link rel="stylesheet" type="text/css" href="Module/css/iconfont.css"/>
<link rel="stylesheet" type="text/css" href="Module/proLoss/css/proLoss.css"/>
<script src="Module/commonJs/jquery-1.7.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="Module/commonJs/comMethod.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="Module/commonJs/jquery.pagination.js"></script>
<script src="Module/commonJs/checkStr.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="Module/commonJs/echarts-2.2.1/build/dist/echarts.js"></script>
<script type="text/javascript" src="Module/commonJs/echarts-2.2.1/build/themes/macarons.js"></script>
<script type="text/javascript">
var cliHei = document.documentElement.clientHeight;
var pageSize_pl = 8;
var page_index_pl = 0;
var proName_a = "";
var sDate_a = "";
var eDate_a = "";
var status_a = 0;
$(function(){
	judgeTime_1();
	inpTipFocBlur("proNameInp","请输入物料名称","#999","#666");
	choiceOption("compStaInp","active","label","compStaHidInp","iconFont");
	initYearInfo();
	showPagePLList();
});
//初始加载年、月数据
function initYearInfo(){
	var yearArray = getCurrYearArray();
	var yearContent = "";
	for(var j = 0 ; j < yearArray.length ; j++){
		yearContent += "<option value='"+yearArray[j]+"'>"+yearArray[j]+"年</option>";
	}
	$("#sYear").html(yearContent).val(yearArray[yearArray.length - 1]);
	$("#eYear").html(yearContent).val(yearArray[yearArray.length - 1]);
	var monthContent = "";
	var monthValue = "";
	for(var i = 1 ; i <= 12 ; i++){
		if(i < 10){
			monthValue = "0"+i;
		}else{
			monthValue = i;
		}
		monthContent += "<option value='"+monthValue+"'>"+i+"月</option>";
	}
	var currMonth = getCurrMonth();
	$("#sMonth").html(monthContent).val(currMonth);
	$("#eMonth").html(monthContent).val(currMonth);
}
//查看详情
function showDetailData(plId,option){
	$("#proTitle").attr("alt",plId);
	getLossDetail(plId,option);
	$(".layer").show();
	$(".detailData").show();
	$(".detailData").height(cliHei);
	$(".routeDivBox").height(cliHei - $(".detailTit").outerHeight() - $(".smNav").height() - 30);
	createLeftScroll("detailData","routeDivPar","routeDivSon",1);
}
//增加详情
function addDetailData(plId,issId,proNo,batchNo,machNum_total,comStatus){
	if(comStatus == 1){
		alert("该材料已经加工完结，不能再进行加工");
	}else{
		getMadeDepList();
		$("#plId").val(plId);
		$("#issId").val(issId);
		$("#prodNameP").html(proNo);
		$("#proBatchNumP").html(batchNo);
		$("#machNum_total").val(machNum_total);
		$(".layer").show();
		$(".addDetailDiv").show();
	}
}
//清空增加详情页面所有数据
function clearAllData(){
	$("#issId").val("0");
	$("#plId").val("0");
	$("#prodNameP").html("");
	$("#proBatchNumP").html("");
	$("#madeNum").val("");
	$("#complNum").val("");
	$("#lossNum").html("");
	$("#depId").val(0);
	$("#machNum_total").val("0");
	$("#proMadNumDiv").hide();
	$("#proCompNumDiv").hide();
	//清除工序提示层
}
//关闭增加详情
function closeAddDetail(){
	$(".layer").hide();
	$(".addDetailDiv").hide();
	clearAllData();
}
function showDiffDetail(opts){
	$(".smNav p").removeClass("active");
	if(opts == "data"){//数据式
		$("#dataTitP").addClass("active");
		$("#chartTitP").removeClass("active");
		$(".routeDivBox ").show();
		$(".chartDivBox").hide();
		$("#scrollPar_1").show();
	}else if(opts == "chart"){//图表式
		$("#dataTitP").removeClass("active");
		$("#chartTitP").addClass("active");
		$(".routeDivBox ").hide();
		$(".chartDivBox").show();
		$("#scrollPar_1").hide();
	}
	getLossDetail($("#proTitle").attr("alt"),opts);
}
function closeDetDataWin(){
	$(".layer").hide();
	$(".detailData").hide();
	if($("#scrollPar_1").length > 0){
		$("#scrollPar_1").remove();
	}
}
function showProLossDetail(){
	$(".viewDetLay").show();
	$(".viewDetailDiv").show();
	createLeftScroll("viewDetailDiv","smDetailConDiv","smDetailConUl",2);
}
function closeVieDetWin(){
	$(".viewDetLay").hide();
	$(".viewDetailDiv").hide();
	if($("#scrollPar_2").length > 0){
		$("#scrollPar_2").remove();
	}
}
//根据条件分页获取加工损耗信息
function showPagePLList(){
	var inputProName = $("#proNameInp").val();
	if(inputProName == "请输入物料名称"){
		inputProName = "";
	}
	proName_a = inputProName;
	var sYear = $("#sYear").val();
	var sMonth = $("#sMonth").val();
	var eYear = $("#eYear").val();
	var eMonth = $("#eMonth").val();
	var sDate = parseInt(sYear + sMonth);
	var eDate = parseInt(eYear + eMonth);
	if(sDate <= eDate){
		sDate_a = sYear + "-" + sMonth;
		eDate_a = eYear + "-" + eMonth;
		status_a = $("#compStaHidInp").val();
		var allCount = getPLCount(proName_a,sDate_a,eDate_a,status_a);//全部
	    $("#Pagination_pl").pagination(allCount, {
	      callback: pageselectCallback_pl,  //PageCallback() 为翻页调用次函数。
	      prev_text: "上一页",
	      next_text: "下一页 ",
	      items_per_page:pageSize_pl,
	      current_page:page_index_pl,
	      ellipse_text:"...",
	      num_edge_entries: 2,       //两侧首尾分页条目数
	      num_display_entries: 6	//连续分页主体部分分页条目数
	    });
	    /**$("#Pagination_pl").css({
	 	 	"left":parseInt(($("#plTurnPage").width() - $("#Pagination_pl").width())/2),
	 	 	"top":20
	    });**/
	}else{
		alert("时间段选择错误");
	}
}
//获取数量
function getPLCount(){
	var count = 0;
	$.ajax({
	      type:"post",
	      async:false,
	      dataType:"json",
	      data:{proName:proName_a,sDate:sDate_a,eDate:eDate_a,status:status_a},
	      url:"proLoss.do?action=getProLossCount",
	      success:function (json){
	    	  count = json["result"];
	      }
	  });
	return count;
}
//获取数据列表
function getPLossList(pageNo,pageSize){
	var content = "";
	$.ajax({
	      type:"post",
	      async:false,
	      dataType:"json",
	      data:{proName:proName_a,sDate:sDate_a,eDate:eDate_a,status:status_a,pageNo:pageNo,pageSize:pageSize},
	      url:"proLoss.do?action=getProLossList",
	      success:function (json){
	    	  if(json["result"].length > 0){
	    		  $("#plTurnPage").show();
	    		  content += "<ul>";
	    		  var comStatusTxt = "";
	    		  for(var i = 0 ; i < json["result"].length ; i++){
	    			  content += "<li>";
	    			  content += "<p class=lisWid1>"+json["result"][i].pro.proName+"</p>";
	    			  content += "<p class=lisWid3>"+json["result"][i].batchNo+"</p>";
	    			  content += "<p class=lisWid4>"+json["result"][i].matchNum+"</p>";
	    			  content += "<p class=lisWid4>"+json["result"][i].comNum+"</p>";
	    			  content += "<p class=lisWid4>"+json["result"][i].lossNum+"</p>";
	    			  content += "<p class=lisWid4>"+json["result"][i].comRate+"</p>";
	    			  content += "<p class=lisWid1>"+getLocalDate(json["result"][i].startTime) + " 至 " + getLocalDate(json["result"][i].endTime)+"</p>";
	    			  if(json["result"][i].comStatus == 0){
	    				  comStatusTxt = "未完结";
	    			  }else{
	    				  comStatusTxt = "已完结";
	    			  }
	    			  content += "<p class=lisWid4>"+comStatusTxt+"</p>";
	    			  content += "<p class=lisWid1>";
	    			  content += "<a href=javascript:void(0) onclick=showDetailData("+json["result"][i].id+",'data')>查看详情</a>";
	    			  if(json["result"][i].comStatus == 0){
	    				  content += "<a href=javascript:void(0) onclick=addDetailData("+json["result"][i].id+","+json["result"][i].iss.id+",'"+json["result"][i].pro.proName+"','"+json["result"][i].batchNo+"',"+json["result"][i].matchNum+","+json["result"][i].comStatus+")>增加详情</a>";
	    			  }
	    			  content += "</p>";
	    			  content += "</li>";
	    		  }
	    		  content += "</ul>";
	    		  $("#plListDiv").html(content);
	    	  }else{
	    		  $("#plTurnPage").hide();
	    		  $("#plListDiv").html("<div class='noRecCon1'><i class='iconfont icon-noListRec noListRec_1'></i><span>暂无记录</span></div>");
	    	  }
	      }
	  });
}
//显示出列表数据
function pageselectCallback_pl(page_index_pl,jq){
	getPLossList(page_index_pl+1,pageSize_pl);
}
//获取指定入库子标的主键信息的加工剩余数量
function getRemainNum(issId){
	var remainCount = 0;
	$.ajax({
	      type:"post",
	      async:false,
	      dataType:"json",
	      data:{issId:issId},
	      url:"proLoss.do?action=getInStoreRemainNum",
	      success:function (json){
	    	  remainCount = json["result"];
	      }
	});
	return remainCount;
}
//获取所有加工工序
function getMadeDepList(){
	$.ajax({
	      type:"post",
	      async:false,
	      dataType:"json",
	      url:"basic.do?action=getSpecDepList&dOption=1",
	      success:function (json){
	    	  showDepList(json["result"]);
	      }
	});
}
function showDepList(depList){
	var content = "<option value=0>请选择加工工序</option>";
	for(var i = 0 ; i < depList.length ; i++){
		content += "<option value='"+depList[i].id+"'>"+depList[i].depName+"</option>";
	}
	$("#depId").html(content);
}
//获取指定加工部门、指定材料损耗编号下的剩余可加工数量（总计）
function getValidTotalMadeNum(plId,depId){
	var validMadeNum_total = 0;
	$.ajax({
	      type:"post",
	      async:false,
	      dataType:"json",
	      data:{plId:plId,depId:depId},
	      url:"proLoss.do?action=getCurrTotalMadeNum",
	      success:function (json){
	    	  validMadeNum_total = json["result"];
	      }
	});
	return validMadeNum_total;
}
//增加材料加工子表详情信息
function addProduct(){
	var plId = $("#plId").val();
	var issId = $("#issId").val();
	var madeNum = $("#madeNum").val();
	var comNum = $("#complNum").val();
	var lossNum = $("#lossNum").val();
	var depId = $("#depId").val();
	var comStatus = $("#comStatus").val();
	var machNum_total = $("#machNum_total").val();//加工数量（总）
	var flag_1 = false;
	var flag_2 = false;
	var flag_3 = false;
	var flag_0 = false;
	var flag_final = false;
	if(plId != 0 && issId != 0){
		flag_0 = true;
	}
	if(madeNum == ""){
		$("#proMadNumDiv").show();
		$("#proMadNumP").html("加工数量不能为空");
	}else if(!checkIsNumber(madeNum)){
		$("#proMadNumDiv").show();
		$("#proMadNumP").html("加工数量格式错误");
	}else if((getRemainNum(issId) < parseInt(madeNum)) && depId == 6){//荒折为第一步，需要检查加工数量不能大于剩余加工数量
		$("#proMadNumDiv").show();
		$("#proMadNumP").html("数量不能大于剩余加工数量");
	//}else if(depId != 6 && (parseInt(madeNum) > parseInt(getValidTotalMadeNum(plId,depId)))){//其他加工工序需要检查加工数量不能大于可加工数量
	}else if(depId != 6 && (parseInt(madeNum) > parseInt(machNum_total))){//其他加工工序需要检查加工数量不能大于加工数量总计
		$("#proMadNumDiv").show();
		$("#proMadNumP").html("数量不能大于进货数量");
	}else{
		$("#proMadNumDiv").hide();
		flag_1 = true;
	}
	if(comNum == ""){
		$("#proCompNumDiv").show();
		$("#proCompNumP").html("完品数量不能为空");
	}else if(!checkIsNumber(comNum)){
		$("#proCompNumDiv").show();
		$("#proCompNumP").html("完品数量格式错误");
	}else if(parseInt(comNum) > parseInt(madeNum)){
		$("#proCompNumDiv").show();
		$("#proCompNumP").html("完品数量不能超过加工数量");
	}else{
		$("#proCompNumDiv").hide();
		flag_2 = true;
	}
	//放到blue事件中
	if(flag_1 && flag_2){
		//自动计算损耗数量
		$("#lossNum").html(parseInt(madeNum) - parseInt(comNum));
	}
	if(depId == 0){
		$("#comDepDiv").show();
		$("#comDepNumP").html("请选择加工工序");
	}else{
		$("#comDepDiv").hide();
		flag_3 = true;
	}
	if(flag_0 && flag_1 && flag_2 && flag_3 ){
		//增加材料加工详情
		if(depId == 14){
			if(confirm("出货检为加工工序最后环节，需在前面工序完成后进行添加，是否继续?")){
				flag_final = true;
			}
		}else{
			flag_final = true;
		}
		if(flag_final){
			$.ajax({
			      type:"post",
			      async:false,
			      dataType:"json",
			      data:{plId:plId,issId:issId,depId:depId,madeNum:madeNum,comNum:comNum},
			      url:"proLoss.do?action=addProLossSubInfo",
			      success:function (json){
			    	  if(json["result"] == "succ"){
			    		  alert("增加详情成功!");
			    		  closeAddDetail();
			    		  //刷新数据
			    		  showPagePLList();
			    	  }else if(json["result"] == "complete"){//完结
			    		  alert("增加详情成功!");
			    		  closeAddDetail();
			    		  //刷新数据
			    		  showPagePLList();
			    	  }else{
			    		  alert("增加详情失败!");
			    	  }
			      }
			});
		}	
	}
}
//查看详情数据
function getLossDetail(plId,option){
	$.ajax({
	      type:"post",
	      async:false,
	      dataType:"json",
	      data:{plId:plId,optionStr:option},
	      url:"proLoss.do?action=getLossDetail",
	      success:function (json){
	    	 showLossDetail(json["result"],option);
	      }
	});
}
//加载echarts报表
function loadChart(list){
	var allMindSuccRateArray = list[0].allMindSuccRate.split(",");
	var allAbilitySuccRateArray = list[0].currAbilitySuccRate.split(",");
	var allMindNumberArray = list[0].allMindNumber.split(",");
	var allAbilityNumberArray = list[0].allAbilityNumber.split(",");
	var xAxisData_mind = "定向,发散,逆向,抽象,类比,移植,形象,联想";
	var xAxisDataArray_mind = xAxisData_mind.split(",");
	var xAxisData_ability = "理解,分析,表达,实践,质疑,联想,综合,创新";
	var xAxisDataArray_ability = xAxisData_ability.split(",");
	//路径配置
	require.config({
		paths:{
			echarts:'Module/commonJs/echarts-2.2.1/build/dist'
		}
	});
	//使用
	require(
		[
		 	'echarts',
		 	'echarts/chart/bar', // 使用柱状图就加载bar模块，按需加载
		 	'echarts/chart/line'// 使用曲线图就加载bar模块，按需加载
	    ],
	    function(ec){
			// 基于准备好的dom，初始化echarts图表
	    	var myChart_mind = ec.init(getId('chart_mind'),getThemes()); 
			var myChart_ability = ec.init(getId('chart_ability'),getThemes());
	    	var currSubName = "(" + getId("subName").value + ")";
	    	// 为echarts对象加载数据 
            myChart_mind.setOption(getChartData("巴菲特思维统计图"+currSubName,"汇总巴菲特思维正确率","汇总巴菲特思维总数",
            		xAxisDataArray_mind,allMindSuccRateArray,allMindNumberArray)); 
            myChart_ability.setOption(getChartData("巴菲特能力统计图"+currSubName,"汇总巴菲特能力正确率","汇总巴菲特能力总数",
	    			xAxisDataArray_ability,allAbilitySuccRateArray,allAbilityNumberArray));
		});
}
//统计图数据
function getChartData(title,chartData1,chartData2,xAxisDataArray,seriesData1,seriesData2){
	var option = {
		    title : {
		    	x : 'center',
		        text: title
		    },
		    tooltip : {
		        trigger: 'axis'
		    },
		    legend: {
		    	y : '35px',
		    	data:[chartData1,chartData2]
		    },
		    toolbox: {
		        show : true,
		        orient : 'vertical',
		        y : 'center',
		        feature : {
	    		    magicType:{
	    		    	show:true,
	    		    	type:['line','bar']
	    		    },
	    		    restore : {show: true},
		            saveAsImage : {show: true}
		        }
		    },
		    calculable : true,
		    xAxis : [
		        {
		            type : 'category',
		            axisLabel : {
		                show:true,
		                interval: 'auto',    // {number}
		                rotate: 0,
		                margin: 5,
		                formatter: '{value}',
		                textStyle: {
		                    color: '#1e90ff',
		                    fontFamily: 'sans-serif',
		                    fontSize: 12,
		                    fontStyle: 'normal'
		                }
		            },
		            data : [xAxisDataArray[0],xAxisDataArray[1],xAxisDataArray[2],xAxisDataArray[3],
		                    xAxisDataArray[4],xAxisDataArray[5],xAxisDataArray[6],xAxisDataArray[7]]
		        }
		    ],
		    yAxis : [
		        {
		            type : 'value',
		            name : '正确率',
		            axisLabel : {
		                formatter: '{value}%'
		            }
		        },
		        {
		            type : 'value',
		            name : '总量',
		            axisLabel : {
		                formatter: '{value}'
		            }
		        }
		    ],
		    grid : {
		    	x : 40,
		    	y : 80,
		    	x2 : 50,
		    	y2 : 30
		    },
		    series : [
		        {
		            name:chartData1,
		            type:'bar',
		            data:[seriesData1[0],seriesData1[1],seriesData1[2],seriesData1[3],
		                  seriesData1[4],seriesData1[5],seriesData1[6],seriesData1[7]]
		        },
		        {
		            name:chartData2,
		            type:'line',
		            yAxisIndex: 1,
		            data:[seriesData2[0],seriesData2[1],seriesData2[2],seriesData2[3],
		                  seriesData2[4],seriesData2[5],seriesData2[6],seriesData2[7]]
		        }
		    ]
		};
	return option;
}
function showLossDetail(list,option){
	var content = "";
	if(list != null){
		$("#proTitle").html(list[0][5]+"物料产品加工损耗详情");
		if(option == "data"){
			for(var i = 0 ; i < list.length ; i++){
				content += "<div class='comRouteDiv fl'>";
				content += "<p class='prodProc'>"+list[i][4]+"</p>";
				content += "<div class='comConDiv'>";
				content += "<span class='arrowSpan'></span>";
				content += "<p>加工数量："+list[i][0]+"</p>";
				content += "<p>完品数量："+list[i][1]+"</p>";
				content += "<p>损耗数量："+list[i][2]+"</p>";
				var comnRate = (parseFloat(list[i][1]) * 100) / parseFloat(list[i][0]);
				content += "<p>完品率："+comnRate.toFixed(2)+"%</p>";
				content += "<a href='javascript:void(0)' onclick=showProLossDetail("+list[i][3]+")>查看详情</a>";
				content += "</div>";
				content += "</div>";
				content += "<div class='comLineBox horComLine fl'>";
				content += "<div class='arrowLine horzLine'>";
				content += "<span class='comTriSpan triSpanR'></span>";
				content += "</div>";
				content += "</div>";
			}
			$("#routeDivSon").html(content);
		}else if(option == "chart"){
			
		}
	}
}
</script>
</head>
  
<body>
  	<!-- 头部  -->
	<div class="headWrap">
		<img class="logo fl" src="Module/basicInfo/images/logo.png" alt="镜片车间ERP管理系统"/>
		<div class="perInfoBox fr">
			<div class="perInfo clearfix fl">
				<img class="fl" src="Module/basicInfo/images/user.png"/>
				<p class="timeHello fl"></p>
				<p class="fl">${sessionScope.login_real_name}</p>
			</div>
			<a class="exit fr" href="javascript:void(0)" title="退出系统" onclick="loginOut();">
				<i class="iconfont icon-tuichu exitIcon"></i>
			</a>
		</div>
	</div>
	<!-- 主体  -->
	<div class="mainWrap clearfix">
		<!-- 左侧导航  -->
		<div class="leftPart"></div>
		<!-- 右侧对应内容  -->
		<div class="rightPart noSmaNav">
			<!-- 头部搜索框 -->
			<div class="searWrap">
				<div class="searBox comMainWid">
					<p class="fl">
						<span>物料名称：</span>
						<input id="proNameInp" class="searInp inpWid1" type="text" value="请输入物料名称" />
					</p>
					<p class="margLP fl">
						<span>时间段：</span>
						<!--input class="searInp inpWid2" type="text" /-->
						<select  id="sYear"></select>
						<select  id="sMonth"></select>至
						<select  id="eYear"></select>
						<select  id="eMonth"></select>
						<!--span class="yearSpan">年</span>
						<input class="searInp inpWid2" type="text" />
						<span class="monthSpan">月</span-->
					</p>
					<p class="margLP fl">
						<input id="compStaHidInp" type="hidden" value="0"/>
						<span>完结状态：</span>
						<label for="noCompStaInp" class="active">
							<span class="cirSpan"></span>
							<input type="radio" id="noCompStaInp" class="compStaInp" name="compStaInp" value="0" checked/>
							<span>未完结</span>
							<i class='iconfont icon-duihao'></i>
						</label>
						<label for="hasCompStaInp">
							<span class="cirSpan"></span>
							<input type="radio" id="hasCompStaInp" class="compStaInp" name="compStaInp" value="1"/>
							<span>完结</span>
						</label>
					</p>
					<a class="searABtn fl" href="javascript:void(0)" onclick="showPagePLList();">
						查询
						<i class="iconfont icon-search searIcon"></i>
					</a>
				</div>
			</div>
			<!-- 数据列表层  -->
			<div class="dataListDiv comMainWid">
				<div class="dataLisTit">
					<ul>
						<li class="lisWid1">物料名称</li>
						<li class="lisWid3">批次</li>
						<li class="lisWid4">加工数量(总)</li>
						<li class="lisWid4">完工数量(总)</li>
						<li class="lisWid4">损耗数量(总)</li>
						<li class="lisWid4">完品率(总)%</li>
						<li class="lisWid1">加工时间</li>
						<li class="lisWid4">完结状态</li>
						<li class="lisWid1">操作</li>
					</ul>
				</div>
				<div class="dataLisCon" id="plListDiv"></div>
				<div id="plTurnPage" class="comTurnPagDiv">
					<div id="Pagination_pl" class="pagination clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="layer"></div>
	<!-- 查看详情下数据层  -->
	<div class="detailData">
		<p class="detailTit"><strong id="proTitle" alt="0"></strong><i class="iconfont icon-close closeDetTitIcon" title="关闭" onclick="closeDetDataWin()"></i></p>
		<div class="smNav">
			<p id="dataTitP" class="active" onclick="showDiffDetail('data')">数据详情</p>
			<p id="chartTitP" onclick="showDiffDetail('chart')">图表详情</p>
		</div>
		<!-- 工序路线  -->
		<div id="routeDivPar" class="routeDivBox clearfix">
			<div id="routeDivSon">
				<div class="comRouteDiv fl">
					<p class="prodProc">研磨</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox horComLine fl">
					<div class="arrowLine horzLine">
						<span class="comTriSpan triSpanR"></span>
					</div>
				</div>
				<div class="comRouteDiv fl">
					<p class="prodProc">芯取</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox horComLine fl">
					<div class="arrowLine horzLine">
						<span class="comTriSpan triSpanR"></span>
					</div>
				</div>
				<div class="comRouteDiv fl">
					<p class="prodProc">滤镜</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox vertComLine">
					<div class="arrowLine vertLine posVerLineR">
						<span class="comTriSpan triSpanB"></span>
					</div>
				</div>
				<!-- 当len==4的时候，添加float:right  -->
				<div class="comRouteDiv fr posDiv">
					<p class="prodProc">滤镜</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox horComLine fr">
					<div class="arrowLine horzLine">
						<span class="comTriSpan triSpanL"></span>
					</div>
				</div>
				<div class="comRouteDiv fr">
					<p class="prodProc">芯取</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox horComLine fr">
					<div class="arrowLine horzLine">
						<span class="comTriSpan triSpanL"></span>
					</div>
				</div>
				<div class="comRouteDiv fr">
					<p class="prodProc">芯取</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox vertComLine">
					<div class="arrowLine vertLine posVerLineL">
						<span class="comTriSpan triSpanB"></span>
					</div>
				</div>
				<div class="comRouteDiv fl">
					<p class="prodProc">研磨</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox horComLine fl">
					<div class="arrowLine horzLine">
						<span class="comTriSpan triSpanR"></span>
					</div>
				</div>
				<div class="comRouteDiv fl">
					<p class="prodProc">芯取</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：0</p>
						<p>完品数量：0</p>
						<p>损耗数量：0</p>
						<p>完品率：0.00%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox horComLine fl">
					<div class="arrowLine horzLine">
						<span class="comTriSpan triSpanR"></span>
					</div>
				</div>
				<div class="comRouteDiv fl">
					<p class="prodProc">滤镜</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
				<div class="comLineBox vertComLine">
					<div class="arrowLine vertLine posVerLineR">
						<span class="comTriSpan triSpanB"></span>
					</div>
				</div>
				<div class="comRouteDiv fr posDiv">
					<p class="prodProc">滤镜</p>
					<div class="comConDiv">
						<span class="arrowSpan"></span>
						<p>加工数量：1000</p>
						<p>完品数量：980</p>
						<p>损耗数量：20</p>
						<p>完品率：98%</p>
						<a href="javascript:void(0)" onclick="showProLossDetail()">查看详情</a>
					</div>
				</div>
			</div>
		</div>
		<!-- 图表详情  -->
		<div class="chartDivBox">
			我是图标数据层
		</div>
		<!-- 查看每个工序领料损耗详情  -->
		<div class="viewDetLay"></div>
		<div class="viewDetailDiv">
			<p class="viewTit">芯取工序加工损耗详情<i class="iconfont icon-close clVieDetIcon" title="关闭" onclick="closeVieDetWin()"></i></p>
			<ul class="smDetaLisTit">
				<li>工序</li>		
				<li>领料数量</li>
				<li>完品数量</li>
				<li>损耗数量</li>
				<li>完成日期</li>	
				<li>担当</li>
			</ul>
			<div id="smDetailConDiv">
				<ul id="smDetailConUl" class="smDetailCon">
					<li>
						<p>芯取</p>		
						<p>1000</p>
						<p>980</p>
						<p>20</p>
						<p>2017.06.16</p>	
						<p>王明</p>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<!-- 增加详情  -->
	<div class="addDetailDiv">
		<input type="hidden" id="plId" value="0"/>
		<input type="hidden" id="issId" value="0"/>
		<input type="hidden" id="machNum_total" value="0"/>
		<i class="iconfont icon-close closeIcon comTransition" onclick="closeAddDetail();"></i>
		<span class="decSpan"><i class="iconfont icon-detail addDetIcon"></i></span>
		<div class="comAddDiv margT">
			<span class="fl">物料名称：</span>
			<div class="comDisDiv">
				<p id="prodNameP"></p>
			</div>
		</div>
		<div class="comAddDiv margT">
			<span class="fl">生产批次：</span>
			<div class="comDisDiv">
				<p id="proBatchNumP"></p>
			</div>
		</div>
		<div class="comAddDiv">
			<span>加工数量：</span>
			<input type="text" id="madeNum" class="comInp_add"/>
			<div id="proMadNumDiv" class="tipDiv">
				<span class="tipTriSpan"></span>
				<p id="proMadNumP"></p>
			</div>
			<i id="sucProMadNum" class="iconfont icon-duihao sucInfoIcon"></i>
		</div>
		<div class="comAddDiv">
			<span>完品数量：</span>
			<input type="text" id="complNum" class="comInp_add"/>
			<div id="proCompNumDiv" class="tipDiv">
				<span class="tipTriSpan"></span>
				<p id="proCompNumP"></p>
			</div>
			<i id="sucProCompNum" class="iconfont icon-duihao sucInfoIcon"></i>
		</div>
		<div class="comAddDiv">
			<span class="fl">损耗数量：</span>
			<div class="comDisDiv">
				<p id="lossNum"></p>
			</div>
		</div>
		<div class="comAddDiv">
			<span>工序：</span>
			<select id="depId">
				<option value="0">请选择加工工序</option>
			</select>
			<div id="comDepDiv" class="tipDiv">
				<span class="tipTriSpan"></span>
				<p id="comDepNumP"></p>
			</div>
			<i id="sucComDepNum" class="iconfont icon-duihao sucInfoIcon"></i>
		</div>
		<div class="addBot fl">
			<a href="javascript:void(0)" onclick="addProduct()">添加保存</a>
		</div>
	</div>
</body>
</html>
